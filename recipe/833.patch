From 9a04ef15994a0d0a23c31a0d122aa010d0836dbb Mon Sep 17 00:00:00 2001
From: Silvio Traversaro <silvio@traversaro.it>
Date: Fri, 22 Aug 2025 12:03:53 +0200
Subject: [PATCH] Call spec.loader.exec_module in _load_pybind11_module utility

---
 src/torchcodec/_internally_replaced_utils.py | 5 ++++-
 1 file changed, 4 insertions(+), 1 deletion(-)

diff --git a/src/torchcodec/_internally_replaced_utils.py b/src/torchcodec/_internally_replaced_utils.py
index e5b5847d1..b668fa4e2 100644
--- a/src/torchcodec/_internally_replaced_utils.py
+++ b/src/torchcodec/_internally_replaced_utils.py
@@ -50,7 +50,10 @@ def _load_pybind11_module(module_name: str, library_path: str) -> ModuleType:
             f"Unable to load spec for module {module_name} from path {library_path}"
         )
 
-    return importlib.util.module_from_spec(spec)
+    mod = importlib.util.module_from_spec(spec)
+    spec.loader.exec_module(mod)
+    
+    return mod
 
 
 # Note that the return value from this function must match the value used as
